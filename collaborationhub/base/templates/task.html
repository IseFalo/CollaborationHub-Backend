{% load static %}
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Kanban Board</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="stylesheet" href="{% static 'my-css/taskc.css' %}">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">

</head>
<body>
  <div class="app-container">
    <!-- Sidebar Navigation -->
    <nav class="sidebar" id="sidebar">
        <div class="sidebar-header">
            <img src="{% static 'images/logo.png' %}" alt="CJID Logo" class="sidebar-logo">
            <span class="sidebar-toggle" id="sidebarToggle"><i class="fas fa-bars"></i></span>
        </div>
        <ul class="sidebar-menu">
            <li><a href=""><i class="fas fa-home"></i> <span>Dashboard</span></a></li>
            <li class="active"><a href=""><i class="fas fa-tasks"></i> <span>Task Management</span></a></li>
            <li class="sidebar-divider"></li>
            <li><a href=""><i class="fas fa-cog"></i> <span>Settings</span></a></li>
        </ul>
        <div class="sidebar-footer">
            <a href="" id="logoutBtn"><i class="fas fa-sign-out-alt"></i> <span>Logout</span></a>
        </div>
    </nav>

    <!-- Main Content Area -->
    <main class="main-content">
        <!-- Top Header -->
        <header class="header">
            <div class="header-left">
                <h1>Task Management</h1>
            </div>
            <div class="header-right">
                <div class="search-bar">
                    <input type="text" placeholder="Search tasks..." id="searchTasks">
                    <button><i class="fas fa-search"></i></button>
                </div>
                <button class="create-task-btn" id="createTaskBtn">
                    <i class="fas fa-plus"></i> <span>New Task</span>
                </button>
                <div class="notification-bell" id="notificationBell">
                    <i class="fas fa-bell"></i>
                    <span class="notification-count" id="notificationCount">0</span>
                </div>
                <div class="user-profile" id="userProfile">
                    <!-- <img src="{{ user.profile_image.url|default:'{% static "images/default-avatar.png" %}' }}" alt="{{ user.username }}"> -->
                    <div class="user-info">
                        <span class="user-name">{{ user.get_full_name }}</span>
                        <span class="user-role">{{ user.role }}</span>
                    </div>
                </div>
            </div>
        </header>

    <div class="container">
        
        <!-- Kanban Board -->
        <div class="kanban-board" id="kanbanBoard">
        <!-- TO DO Column -->
        <div class="column-content" id="todoColumn">
            {% for task in todo_tasks %}
            <div class="task-card">
                <h4>{{ task.title }}</h4>
                <p>{{ task.description }}</p>
                <small>Assigned to: {{ task.assigned_to.username }}</small>
            </div>
            {% empty %}
            <p>No tasks</p>
            {% endfor %}
        </div>
        
        <!-- IN PROGRESS Column -->
        <div class="column-content" id="inProgressColumn">
            {% for task in in_progress_tasks %}
            <div class="task-card">
                <h4>{{ task.title }}</h4>
                <p>{{ task.description }}</p>
                <small>Assigned to: {{ task.assigned_to.username }}</small>
            </div>
            {% empty %}
            <p>No tasks</p>
            {% endfor %}
        </div>
        
        <!-- COMPLETED Column -->
        <div class="column-content" id="completedColumn">
            {% for task in completed_tasks %}
            <div class="task-card">
                <h4>{{ task.title }}</h4>
                <p>{{ task.description }}</p>
                <small>Assigned to: {{ task.assigned_to.username }}</small>
            </div>
            {% empty %}
            <p>No tasks</p>
            {% endfor %}
        </div>
        </div>
    </div>

    <!-- default hidden for form task -->
             <!-- Task Modal (Hidden by default) -->
             <div class="modal" id="taskModal">
              <div class="modal-content">
                  <div class="modal-header">
                      <h2 id="modalTitle">Create New Task</h2>
                      <span class="close-modal" id="closeModal">&times;</span>
                  </div>
                  <div class="modal-body">
                      <form id="taskForm" method="POST">
                          {% csrf_token %}
                          <input type="hidden" id="taskId" name="task_id">
                          <div class="form-group">
                              <label for="taskTitle">Task Title</label>
                              <input type="text" id="taskTitle" name="title" required>
                          </div>
                          <div class="form-group">
                              <label for="taskDescription">Description</label>
                              <textarea id="taskDescription" name="description" rows="4"></textarea>
                          </div>
                          <div class="form-row">
                              <div class="form-group half">
                                  <label for="taskAssignee">Assign To</label>
                                  <select id="taskAssignee" name="assignee">
                                      <option value="" selected disabled>Select team member</option>
                                      {% for team_member in team_members %}
                                      <option value="{{ team_member.id }}">{{ team_member.full_name }}</option>
                                      {% endfor %}
                                  </select>
                              </div>

                          </div>
                          <div class="form-row">
                              <div class="form-group half">
                                  <label for="taskStatus">Status</label>
                                  <select id="taskStatus" name="status">
                                      <option value="todo" selected>To-Do</option>
                                      <option value="inprogress">In Progress</option>
                                      <option value="completed">Completed</option>
                                  </select>
                              </div>

                          </div>
                          <div class="modal-footer">
                            <button class="cancel-btn" id="cancelTaskBtn">Cancel</button>
                            <button class="save-btn" id="saveTaskBtn">Create Task</button>
                        </div>
                      </form>
                  </div>

              </div>
          </div>
      </div>
    <script src="{% static 'my-js/tasks.js' %}"></script>
</body>
</html>